CREATE DATABASE DeAnCongTy
GO
USE DeAnCongTy
 
GO   
	CREATE TABLE NHANVIEN
	(
		HONV VARCHAR(15),
		TENLOT VARCHAR(15),
		TENNV VARCHAR(15),
		MANV CHAR(9)NOT NULL,
		NGSINH DATETIME,
		DCHI VARCHAR(50),
		PHAI CHAR(3) ,
		LUONG FLOAT,
		MA_NQL CHAR(9),
		PHG INT ,
		
	)


GO

	
	CREATE TABLE PHONGBAN
	(
		TENPHG VARCHAR(15),
		MAPHG INT NOT NULL,
		TRPHG CHAR(9),
		NG_NHANCHUC DATETIME ,
		
	)

GO
	
	CREATE TABLE DIADIEM_PHG
	(	
		MAPHG INT  NOT NULL,
		DIADIEM VARCHAR(15) NOT NULL,
		

	)
GO
	
	CREATE TABLE PHANCONG
	(
		MA_NVIEN CHAR(9) NOT NULL,
		SODA INT NOT NULL,
		THOIGIAN FLOAT,
		
	)

GO
	
	CREATE TABLE DEAN
	(
		TENDA VARCHAR (15) ,
		MADA INT  NOT NULL,
		DDIEM_DA VARCHAR(15),
		PHONG INT ,
	)

GO
	
	CREATE TABLE THANNHAN
(
	MA_NVIEN CHAR(9)  NOT NULL,
	TENTN VARCHAR(15) NOT NULL,
	PHAI	CHAR(3),
	NGSINH	DATETIME,
	QUANHE	VARCHAR(8),
	
)

GO
-- KHI XOA BANG BANG NAO DUOC THAM CHIEU THI PHAI XOA KHOA NGOAI THAM CHIEU DEN NO RUI MOI XOA NO
-- TU "GO" CHI QUAN TRONG DOI VOI TU "USE" CON DAU KO CAN TU GO VAN CO THE CHO CHAY TOAN BO CSDL OK
-- THEM RANG BUOC KHOA CHINH CHO CAC BANG:
ALTER TABLE NHANVIEN ADD CONSTRAINT PK_MANV PRIMARY KEY (MANV)
GO
ALTER TABLE PHONGBAN ADD CONSTRAINT PK_MAPHG PRIMARY KEY (MAPHG)
GO
ALTER TABLE DIADIEM_PHG ADD CONSTRAINT PK_MAPHG_DIADIEM PRIMARY KEY (MAPHG,DIADIEM)
GO
ALTER TABLE DEAN ADD CONSTRAINT PK_MADA PRIMARY KEY (MADA)
GO
ALTER TABLE PHANCONG ADD CONSTRAINT PK_PHANCONG_MA_NVIEN_SODA PRIMARY KEY(MA_NVIEN,SODA)
GO
ALTER TABLE THANNHAN ADD CONSTRAINT PK_MANVIEN_TENTN PRIMARY KEY(MA_NVIEN,TENTN)
GO
-- THEM RANG BUOC KHOA NGOAI CHO CAC BANG :
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN_PHG_PHONGBAN FOREIGN KEY (PHG)REFERENCES PHONGBAN(MAPHG)
GO
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN_MA_NQL_NHANVIEN FOREIGN KEY(MA_NQL) REFERENCES NHANVIEN(MANV)
GO
ALTER TABLE PHONGBAN ADD CONSTRAINT FK_PHONGBAN_TRPHG_NHANVIEN FOREIGN KEY (TRPHG)REFERENCES NHANVIEN(MANV)
GO
ALTER TABLE DIADIEM_PHG ADD CONSTRAINT FK_DIEMDIEM_PHG_MAPHG_PHONGBAN FOREIGN KEY (MAPHG)REFERENCES PHONGBAN(MAPHG)
GO
ALTER TABLE DEAN ADD CONSTRAINT FK_DEAN_PHONG_PHONGBAN FOREIGN KEY (PHONG) REFERENCES PHONGBAN(MAPHG)
GO
ALTER TABLE PHANCONG ADD CONSTRAINT FK_PHANCONG_MA_NVIEN_NHANVIEN FOREIGN KEY (MA_NVIEN)REFERENCES NHANVIEN(MANV),CONSTRAINT FK_PHANCONG_SODA_DEAN FOREIGN KEY(SODA) REFERENCES DEAN(MADA)
GO
ALTER TABLE THANNHAN ADD CONSTRAINT FK_THANNHAN_MANVIEN_NHANVIEN FOREIGN KEY (MA_NVIEN)REFERENCES NHANVIEN(MANV)
GO
-- THEM RANG BUOC CHECK VAO CAC THUOC TINH CUA CAC BANG:
ALTER TABLE NHANVIEN ADD CONSTRAINT CHK_NHANVIEN_PHAI CHECK(PHAI IN('NAM','NU'))
GO
ALTER TABLE PHONGBAN ADD CONSTRAINT UNI_PHONGBAN_TENPHG UNIQUE(TENPHG)
GO
ALTER TABLE PHANCONG ADD CONSTRAINT CHK_PHANCONG_THOIGIAN CHECK (THOIGIAN IN(1,5))
ALTER TABLE PHANCONG DROP  CHK_PHANCONG_THOIGIAN
-- KIEM TRA CAU TRUC CUA BANG:
SP_HELP NHANVIEN
SP_HELP PHONGBAN
SP_HELP DIADIEM_PHG
SP_HELP PHANCONG
SP_HELP DEAN
SP_HELP THANNHAN
-- KIEM TRA CAC RANG BUOC TRONG BANG:
SP_HELPCONSTRAINT NHANVIEN
SP_HELPCONSTRAINT PHONGBAN
SP_HELPCONSTRAINT DIADIEM_PHG
SP_HELPCONSTRAINT PHANCONG
SP_HELPCONSTRAINT DEAN
SP_HELPCONSTRAINT THANNHAN
GO
ALTER TABLE PHONGBAN NOCHECK  CONSTRAINT ALL
INSERT INTO PHONGBAN VALUES ( 'Nghien cuu', 5 ,333445555,05/22/1998)
INSERT INTO PHONGBAN VALUES ('Dieu Hang',4,987987987,1995/01/01)
INSERT INTO PHONGBAN VALUES ('Quan Li',1,888665555,19/06/1981)
ALTER TABLE PHONGBAN NOCHECK CONSTRAINT ALL
GO
INSERT INTO NHANVIEN VALUES ('Nguyen','Thanh','Tung',333445555,'12/08/1955','638 Nguyen Van Cu, Q5, TP HCM','Nam',4000,888665555,5)
INSERT INTO NHANVIEN VALUES ('Bui','Ngoc','Hang',999887777,19/07/1968,'638 Nguyen Van Cu,Q5, TP HCM','Nu',25000,987654321,4)
INSERT INTO NHANVIEN VALUES ('Le','Quynh','Nhu',987654321,'06/20/1951','291 Ho Van Hue, QPN, TP HCM','Nu',43000,888665555,4)
INSERT INTO NHANVIEN VALUES ('Nguyen','Manh','Hung',666884444,'06/20/1951','957 Ba Ria, Vung Tau','Nam',38000,333445555,5)
INSERT INTO NHANVIEN VALUES ('Tran','Thanh','Tam',453453453,'07/31/1972','543 Mai Thi Luu,Q1,TP HCM','Nam',38000,333445555,5) 
INSERT INTO NHANVIEN VALUES ('Tran','Hong','Quang',987987987,03/09/1969,'980 Le Hong Phong,Q10,TPHCM','Nam',25000,333445555,4)
INSERT INTO NHANVIEN VALUES ('Pham','Van','Vinh',888665555,11/10/1937,'450 Trung Vuong,Ha Noi','Nam',55000, NULL,1)
INSERT INTO NHANVIEN VALUES ('Dinh',' Ba', 'Tien', 123456789,' 01/09/1965','731 Tran Hung Dao Q1 TP HCM' , 'Nam', 30000,333445555,5)
ALTER TABLE NHANVIEN CHECK CONSTRAINT ALL
ALTER TABLE PHONGBAN CHECK CONSTRAINT ALL



-- THEM DU LIEU VAO BANG DIADIEM_PHG: 
INSERT INTO DIADIEM_PHG VALUES(1,'TP HCM')
INSERT INTO DIADIEM_PHG VALUES(4,'HA NOI')
INSERT INTO DIADIEM_PHG VALUES(5,'VUNG TAU')
INSERT INTO DIADIEM_PHG VALUES(5,'NHA TRANG')
INSERT INTO DIADIEM_PHG VALUES(5,'TP HCM')
-- THEM DU LIEU VAO BANG NHANVIEN:

INSERT INTO NHANVIEN (HONV ,TENLOT ,TENNV , MANV , NGSINH , DCHI , PHAI ,LUONG , PHG)VALUES ('Nguyen','Thanh','Tung',333445555,'12/08/1955','638 Nguyen Van Cu, Q5, TP HCM','Nam',40000,5)
INSERT INTO NHANVIEN (HONV ,TENLOT ,TENNV , MANV , NGSINH , DCHI , PHAI ,LUONG , PHG)VALUES ('Bui','Ngoc','Hang',999887777,19/07/1968,'638 Nguyen Van Cu,Q5, TP HCM','Nu',25000,4)
INSERT INTO NHANVIEN (HONV ,TENLOT ,TENNV , MANV , NGSINH , DCHI , PHAI ,LUONG , PHG)VALUES ('Le','Quynh','Nhu',987654321,'06/20/1951','291 Ho Van Hue, QPN, TP HCM','Nu',43000,4)
INSERT INTO NHANVIEN (HONV ,TENLOT ,TENNV , MANV , NGSINH , DCHI , PHAI ,LUONG , PHG)VALUES ('Nguyen','Manh','Hung',666884444,'06/20/1951','957 Ba Ria, Vung Tau','Nam',38000,5)
INSERT INTO NHANVIEN (HONV ,TENLOT ,TENNV , MANV , NGSINH , DCHI , PHAI ,LUONG , PHG)VALUES ('Tran','Thanh','Tam',453453453,'07/31/1972','543 Mai Thi Luu,Q1,TP HCM','Nam',25000,5) 
INSERT INTO NHANVIEN (HONV ,TENLOT ,TENNV , MANV , NGSINH , DCHI , PHAI ,LUONG , PHG)VALUES ('Tran','Hong','Quang',987987987,03/09/1969,'980 Le Hong Phong,Q10,TP HCM','Nam',25000,4)
INSERT INTO NHANVIEN (HONV ,TENLOT ,TENNV , MANV , NGSINH , DCHI , PHAI ,LUONG , PHG)VALUES ('Pham','Van','Vinh',888665555,11/10/1937,'450 Trung Vuong,Ha Noi','Nam',55000,1)
INSERT INTO NHANVIEN (HONV ,TENLOT ,TENNV , MANV , NGSINH , DCHI , PHAI ,LUONG , PHG)VALUES ('Dinh',' Ba', 'Tien', 123456789,' 01/09/1965','731 Tran Hung Dao Q1 TP HCM' , 'Nam', 30000,5)

-- THEM DU LIEU VAO BANG THAN NHAN:
INSERT INTO THANNHAN VALUES(333445555,'Trinh','Nu',04/05/1986,'Con gai')
INSERT INTO THANNHAN VALUES(333445555,'Khang','Nam',10/25/1983,'Con trai')
INSERT INTO THANNHAN VALUES(333445555,'Phuong','Nu',05/03/1958,'Vo chong')
INSERT INTO THANNHAN VALUES(987654321,'Minh','Nam',02/28/1942,'Vo chong')
INSERT INTO THANNHAN VALUES(123456789,'Tien','Nam',01/01/1988,'Con trai')
INSERT INTO THANNHAN VALUES(123456789,'Chau','Nu',12/30/1988,'Con gai')
INSERT INTO THANNHAN VALUES(123456789,'Phuong','Nu',05/05/1967,'Vo chong')
-- THEM DU LIEU VAO BANG DEAN: 

INSERT INTO DEAN VALUES ('San pham X',1,'VUNG TAU',5)
INSERT INTO DEAN VALUES ('San pham Y',2,'Nha Trang',5)
INSERT INTO DEAN VALUES ('San pham Z',3,'TP HCM',5)
INSERT INTO DEAN VALUES ('Tin Hoc Hoa',10,'HA NOI',4)
INSERT INTO DEAN VALUES ('Cap Quang',20,'TP HCM',1)
INSERT INTO DEAN VALUES ('Dao Tao',30,'HA NOI',4)
-- THAM DU LIEU VAO BANG PHANCONG:

INSERT INTO PHANCONG VALUES (123456789,1,32.5)
INSERT INTO PHANCONG VALUES (123456789,2,7.5)
INSERT INTO PHANCONG VALUES (666884444,3,40.0)
INSERT INTO PHANCONG VALUES (453453453,1,20.0)
INSERT INTO PHANCONG VALUES (453453453,2,20.0)
INSERT INTO PHANCONG VALUES (333445555,2,10.0)
INSERT INTO PHANCONG VALUES (333445555,3,10.1)
INSERT INTO PHANCONG VALUES (333445555,10,10.0)
INSERT INTO PHANCONG VALUES (333445555,20,10.0)
INSERT INTO PHANCONG VALUES (999887777,30,30.0)
INSERT INTO PHANCONG VALUES (999887777,10,10.0)
INSERT INTO PHANCONG VALUES (987987987,10,35.0)
INSERT INTO PHANCONG VALUES (987987987,30,5.0)
INSERT INTO PHANCONG VALUES (987654321,30,20.0)
INSERT INTO PHANCONG VALUES (987654321,20,15.0)
INSERT INTO PHANCONG VALUES (888665555,20,NULL)
--UPDATE BANG NHANVIEN:

UPDATE NHANVIEN SET MA_NQL ='333445555' WHERE MANV = 123456789
UPDATE NHANVIEN SET MA_NQL =888665555 	WHERE MANV = 333445555
UPDATE NHANVIEN SET MA_NQL = 987654321 WHERE MANV =999887777
UPDATE NHANVIEN SET MA_NQL = 888665555 WHERE MANV = 987654321
UPDATE NHANVIEN SET MA_NQL = 333445555 WHERE MANV=666884444
UPDATE NHANVIEN SET MA_NQL = 333445555 WHERE MANV = 453453453
UPDATE NHANVIEN SET MA_NQL = 987654321 WHERE MANV=987987987
--UPDATE BANG PHONGBAN:
UPDATE PHONGBAN SET TRPHG=333445555 WHERE MAPHG=5
UPDATE PHONGBAN SET TRPHG=987987987 WHERE MAPHG=4
UPDATE PHONGBAN SET TRPHG=888665555 WHERE MAPHG=1



